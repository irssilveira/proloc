

function countChecked(){"all"===checkState&&$(".bulk_action input[name='table_records']").iCheck("check"),"none"===checkState&&$(".bulk_action input[name='table_records']").iCheck("uncheck");var e=$(".bulk_action input[name='table_records']:checked").length;e?($(".column-title").hide(),$(".bulk-actions").show(),$(".action-cnt").html(e+" Records Selected")):($(".column-title").show(),$(".bulk-actions").hide())}!function(e,t){var n=function(e,t,n){var i;return function(){function c(){n||e.apply(a,o),i=null}var a=this,o=arguments;i?clearTimeout(i):n&&e.apply(a,o),i=setTimeout(c,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",n(e)):this.trigger(t)}}(jQuery,"smartresize");var CURRENT_URL=window.location.href.split("?")[0],$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){var e=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$BODY.hasClass("footer_fixed")?-10:$FOOTER.height(),n=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),i=n>e?n:e;i-=$NAV_MENU.height()+t,$RIGHT_COL.css("min-height",i)};$SIDEBAR_MENU.find("a").on("click",function(t){var n=$(this).parent();n.is(".active")?(n.removeClass("active active-sm"),$("ul:first",n).slideUp(function(){e()})):(n.parent().is(".child_menu")||($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),n.addClass("active"),$("ul:first",n).slideDown(function(){e()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),e()}),$SIDEBAR_MENU.find('a[href="'+CURRENT_URL+'"]').parent("li").addClass("current-page"),$SIDEBAR_MENU.find("a").filter(function(){return this.href==CURRENT_URL}).parent("li").addClass("current-page").parents("ul").slideDown(function(){e()}).parent().addClass("active"),$(window).smartresize(function(){e()}),e(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}})}),$(document).ready(function(){$(".collapse-link").on("click",function(){var e=$(this).closest(".x_panel"),t=$(this).find("i"),n=e.find(".x_content");e.attr("style")?n.slideToggle(200,function(){e.removeAttr("style")}):(n.slideToggle(200),e.css("height","auto")),t.toggleClass("fa-chevron-up fa-chevron-down")}),$(".close-link").click(function(){var e=$(this).closest(".x_panel");e.remove()})}),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})}),$(".progress .progress-bar")[0]&&$(".progress .progress-bar").progressbar(),$(document).ready(function(){if($(".js-switch")[0]){var e=Array.prototype.slice.call(document.querySelectorAll(".js-switch"));e.forEach(function(e){new Switchery(e,{color:"#26B99A"})})}}),$(document).ready(function(){$("input.flat")[0]&&$(document).ready(function(){$("input.flat").iCheck({checkboxClass:"icheckbox_flat-green",radioClass:"iradio_flat-green"})})}),$("table input").on("ifChecked",function(){checkState="",$(this).parent().parent().parent().addClass("selected"),countChecked()}),$("table input").on("ifUnchecked",function(){checkState="",$(this).parent().parent().parent().removeClass("selected"),countChecked()});var checkState="";$(".bulk_action input").on("ifChecked",function(){checkState="",$(this).parent().parent().parent().addClass("selected"),countChecked()}),$(".bulk_action input").on("ifUnchecked",function(){checkState="",$(this).parent().parent().parent().removeClass("selected"),countChecked()}),$(".bulk_action input#check-all").on("ifChecked",function(){checkState="all",countChecked()}),$(".bulk_action input#check-all").on("ifUnchecked",function(){checkState="none",countChecked()}),$(document).ready(function(){$(".expand").on("click",function(){$(this).next().slideToggle(200),$expand=$(this).find(">:first-child"),"+"==$expand.text()?$expand.text("-"):$expand.text("+")})}),"undefined"!=typeof NProgress&&($(document).ready(function(){NProgress.start()}),$(window).load(function(){NProgress.done()}));

setTimeout(function (){$('.esconde').hide('fast')}, 4000);
setTimeout(function (){$('.sucesso').hide('fast')}, 4000);

$(document).ready(function () {
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });
    /* COMEÇO JS CLIENTE */
    $(document).on('click', 'input[type=radio]', function(){
        var escolhido = $(this).prop('id');
        if(escolhido == "juridica"){
            $('#razaoSocialNome').addClass('show').removeClass('hide').val('');
            $('#cpf').removeClass('show').addClass('hide').prop('disabled',true).val('');
            $('#rg').removeClass('show').addClass('hide').prop('disabled',true).val('');
            $('#cnpj').removeClass('hide').addClass('show').prop('disabled',false);
            $('#inscricaoEstadual').removeClass('hide').addClass('show').prop('disabled',false);
        }else{
            $('#razaoSocialNome').addClass('show').removeClass('hide').val('');
            $('#inscricaoEstadual').removeClass('show').addClass('hide').prop('disabled',true).val('');
            $('#cnpj').removeClass('show').addClass('hide').prop('disabled',true).val('');
            $('#rg').removeClass('hide').addClass('show').prop('disabled',false);
            $('#cpf').removeClass('hide').addClass('show').prop('disabled',false);
        }
    });

    //Preencher o campo com o cep

    $('#cep').blur(function(){
        /* Configura a requisição AJAX */
        $.ajax({
            url : '/consultar_cep', /* URL que será chamada */
            type : 'GET', /* Tipo da requisição */
            data: 'cep=' + $('#cep').val(), /* dado que será enviado via POST */
            dataType: 'json', /* Tipo de transmissão */
            success: function(data){
                console.log(data.sucesso);
                if(data.sucesso == 1){
                    $('#rua').val(data.rua);
                    $('#bairro').val(data.bairro);
                    $('#cidade').val(data.cidade);
                    $('#estado').val(data.estado);
                    $('#numero').focus();

                }
                if(data.sucesso == 2){

                    $('#rua').val('').removeAttr('readonly').focus();

                    $('#bairro').val('').removeAttr('readonly');
                    $('#cidade').val(data.cidade);
                    $('#estado').val(data.estado);

                }
            }
        });
        return false;
    });

    /* fim js cliente */


    $('#formLead').submit(function () {
        event.preventDefault();
        $.ajax({
            type: 'POST',
            url: '/leads/salvarleadhistorico',
            data:$(this).serialize(),
            dataType: 'json',
            beforeSend: function () {
                $('#ajaxLoading').removeClass('hide').fadeIn(1000);
            },
            success:function(data)
            {
                $('#ajaxLoading').hide('fast');

                var novaData = (data.dataRetorno).split('-');
                novaData = novaData[2] + "/" + novaData[1] + "/" + novaData[0];
                var dataCadastrada = novaData;
                dataCadastrada = dataCadastrada.split("/");
                var dataCompara = new Date(dataCadastrada[2], dataCadastrada[1] - 1, dataCadastrada[0]);

                var row = '<tr><td>' + data.id + '</td>';
                if(dataCompara > new  Date()){
                    row+= '<td style="background-color:#5bf98b">'+novaData+'</td>';
                }else{
                    row+= '<td style="background-color:#FF7D7D">'+novaData+'</td>'
                }
                row += '<td>' + data.observacao + '</td><td width="5%" class="text-center vertical-middle"><div class="dropdown"><a href="/leads/'+data.id+'/'+data.lead_id+'/inativarleadhistorico" class="btn btn-xs btn-primary"><i class="fa fa-plus"></i></a></div></td></tr>';
                $('#tableLeadHistorico tbody').prepend(row);
                $('.salvarSucesso').removeClass('hide').fadeIn(1000);
                $('#formLead')[0].reset();

            },
        });
    })



    $()
    $('#salvarPartida').submit(function (e) {
        e.preventDefault();

        $.ajax({
            type: 'POST',
            url: '/ponto-partida',
            data:$(this).serialize(),
            dataType: 'json',
            beforeSend:function(){
                $('#ajaxLoading').removeClass('hide').fadeIn(1000);
            },
            success: function (data) {
                $('#ajaxLoading').hide();
                if(data.success){
                    $('.salvarSucesso').removeClass('hide').fadeIn(1000);
                    setTimeout(function (){$('.salvarSucesso').hide('fast')}, 4000);
                }else{
                    $('.errorSalvar').removeClass('hide').fadeIn(1000);
                    setTimeout(function (){$('.errorSalvar').hide('hide')}, 4000);
                }
            }
        });
    });
    $('#leadsInativos').on('click',function (e) {
        e.preventDefault();
        $.ajax({
            type: 'GET',
            url: '/leads/leadsinativo',
            dataType: 'json',
            data: 'leads',
            beforeSend:function(){
                $('#resultado').css('opacity','0.5');

                $('#ajaxLoading').removeClass('hide').fadeIn(1000);
            },
            success: function (data) {
                $('#resultado').empty();

                var len = data.total;
                var lead = data.data;
                $('html, body').animate({scrollTop: 0}, 'slow');
                var html =  '';
                console.log(lead);
                for(var i = 0;i<len;i++){
                    console.log(lead[i].dataRetorno);

                    var dataConfig = lead[i].dataRetorno;

                    var novaData = lead[i].dataRetorno.split('-');
                    novaData = novaData[2] + "/" + novaData[1] + "/" + novaData[0];
                    html += '<tr>'
                    html+='  <td class="vertical-middle" data-title="ID">'+lead[i].id+'</td>';
                    html+=' <td data-title="Retorno" style="background-color:#FF7D7D">'+novaData+'</td>';
                    html+='  <td data-title="Nome">'+lead[i].nome+'</td>';
                    html+='  <td data-title="Email">'+lead[i].email+'</td>';
                    html+='  <td data-title="telefone">'+lead[i].telefone+'</td>';
                    html+='  <td data-title="cidade">'+lead[i].cidade+'</td>';
                    html+= '<td  class="text-center vertical-middle"><div class="dropdown"> <a href="leads/'+lead[i].id+'/editelead" class="btn btn-md btn-primary"><i class="fa fa-pencil"></i></a> </div> </td>';
                    html+= '</tr>';
                }

                $('#resultado').append(html);
                $('#resultado').css('opacity','1');
                $('#ajaxLoading').hide();

            }

        });
    })
    //lightbox

    lightbox.option({
        'resizeDuration': 200,
        'wrapAround': true
    })


});

window.onload = function() {

    if (navigator.geolocation) {


        navigator.geolocation.getCurrentPosition(handle_geolocation_query, handle_errors);
    }
    else {
        yqlgeo.get('visitor', normalize_yql_response);
    }


    function handle_errors(error) {

        switch (error.code) {
            case error.PERMISSION_DENIED:

                alert("Permissão negada pelo navegador!");
                break;

            case error.POSITION_UNAVAILABLE:
                alert("Não conseguimos encontrar sua localização");

                break;

            case error.TIMEOUT:
                alert("Erro ao tentar te localizar o tempo de busca esgotou.");

                break;

            default:
                alert("Erro desconhecido. Chama o administrador do sistema.");

                break;
        }
    }

    function normalize_yql_response(response) {
        if (response.error) {
            var error = {code: 0};
            handle_error(error);
            return;
        }

        var position = {

            coords: {
                latitude: response.place.centroid.latitude,
                longitude: response.place.centroid.longitude
            },
            address: {
                city: response.place.locality2.content,
                region: response.place.admin1.content,
                country: response.place.country.content
            }
        };

        handle_geolocation_query(position);
    }

    function handle_geolocation_query(position) {
        var src_mapa = "https://maps.googleapis.com/maps/api/staticmap?sensor=false&center=" + position.coords.latitude + "," +
            position.coords.longitude + "&zoom=14&size=300x400&markers=color:blue|label:S|" +
            position.coords.latitude + ',' + position.coords.longitude + "&key=AIzaSyDxQZuypz7a_tl3H_AfEIICPl0CQdqqHHg";

        $('#longitude').val(position.coords.longitude);
        $('#latitude').val(position.coords.latitude);
        $('#src_mapa').val(src_mapa);

    }
}
